<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p253" style="overflow: hidden; position: relative; background-color: white; width: 714px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_253{left:65px;bottom:947px;letter-spacing:0.02px;word-spacing:0.94px;}
#t2_253{left:65px;bottom:897px;letter-spacing:0.06px;word-spacing:-0.17px;}
#t3_253{left:83px;bottom:865px;letter-spacing:0.13px;word-spacing:-0.28px;}
#t4_253{left:65px;bottom:843px;letter-spacing:0.13px;word-spacing:0.06px;}
#t5_253{left:65px;bottom:821px;letter-spacing:0.12px;word-spacing:-0.28px;}
#t6_253{left:83px;bottom:799px;letter-spacing:0.11px;word-spacing:3.06px;}
#t7_253{left:64px;bottom:777px;letter-spacing:0.13px;word-spacing:2.27px;}
#t8_253{left:511px;bottom:777px;letter-spacing:0.11px;}
#t9_253{left:557px;bottom:777px;letter-spacing:0.17px;word-spacing:2.18px;}
#ta_253{left:65px;bottom:755px;letter-spacing:0.15px;word-spacing:1.47px;}
#tb_253{left:65px;bottom:734px;letter-spacing:0.1px;}
#tc_253{left:127px;bottom:734px;letter-spacing:0.11px;}
#td_253{left:173px;bottom:734px;letter-spacing:0.15px;word-spacing:-0.83px;}
#te_253{left:65px;bottom:712px;letter-spacing:0.14px;word-spacing:0.01px;}
#tf_253{left:65px;bottom:690px;letter-spacing:0.12px;word-spacing:-0.19px;}
#tg_253{left:65px;bottom:668px;letter-spacing:0.12px;word-spacing:-0.48px;}
#th_253{left:432px;bottom:635px;letter-spacing:-0.17px;word-spacing:0.04px;}
#ti_253{left:181px;bottom:635px;letter-spacing:-0.13px;}
#tj_253{left:108px;bottom:600px;letter-spacing:-0.15px;}
#tk_253{left:108px;bottom:565px;letter-spacing:-0.15px;}
#tl_253{left:108px;bottom:531px;letter-spacing:-0.15px;}
#tm_253{left:83px;bottom:477px;letter-spacing:0.12px;word-spacing:1.36px;}
#tn_253{left:65px;bottom:455px;letter-spacing:0.16px;word-spacing:-1.07px;}
#to_253{left:65px;bottom:433px;letter-spacing:0.13px;word-spacing:-0.08px;}
#tp_253{left:65px;bottom:411px;letter-spacing:0.12px;word-spacing:0.88px;}
#tq_253{left:65px;bottom:390px;letter-spacing:0.11px;word-spacing:1.14px;}
#tr_253{left:65px;bottom:368px;letter-spacing:0.14px;word-spacing:-0.33px;}
#ts_253{left:83px;bottom:346px;letter-spacing:0.13px;word-spacing:-0.37px;}
#tt_253{left:65px;bottom:324px;letter-spacing:0.05px;word-spacing:0.54px;}
#tu_253{left:65px;bottom:302px;letter-spacing:0.13px;word-spacing:0.57px;}
#tv_253{left:65px;bottom:280px;letter-spacing:0.07px;word-spacing:-0.35px;}
#tw_253{left:65px;bottom:258px;letter-spacing:0.11px;word-spacing:-1.44px;}
#tx_253{left:65px;bottom:236px;letter-spacing:0.14px;word-spacing:-0.32px;}
#ty_253{left:83px;bottom:214px;letter-spacing:0.13px;word-spacing:-0.34px;}
#tz_253{left:65px;bottom:192px;letter-spacing:0.09px;word-spacing:-0.23px;}
#t10_253{left:83px;bottom:170px;letter-spacing:0.11px;word-spacing:0.31px;}
#t11_253{left:65px;bottom:148px;letter-spacing:0.13px;word-spacing:-0.83px;}
#t12_253{left:65px;bottom:127px;letter-spacing:0.13px;word-spacing:4.3px;}
#t13_253{left:65px;bottom:63px;letter-spacing:0.12px;}

.s0_253{font-size:15px;font-family:CharterITC-Italic_90p;color:#000;}
.s1_253{font-size:18px;font-family:FranklinGothicCondITC-Medi_90d;color:#000;}
.s2_253{font-size:15px;font-family:CharterITC-Regular_90v;color:#000;}
.s3_253{font-size:15px;font-family:Iosevka-Custom_901;color:#000;}
.s4_253{font-size:14px;font-family:FranklinGothicITC-Book_2sw;color:#000;}
.t.v0_253{transform:scaleX(0.9);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts253" type="text/css" >

@font-face {
	font-family: CharterITC-Italic_90p;
	src: url("fonts/CharterITC-Italic_90p.woff") format("woff");
}

@font-face {
	font-family: CharterITC-Regular_90v;
	src: url("fonts/CharterITC-Regular_90v.woff") format("woff");
}

@font-face {
	font-family: FranklinGothicCondITC-Medi_90d;
	src: url("fonts/FranklinGothicCondITC-Medi_90d.woff") format("woff");
}

@font-face {
	font-family: FranklinGothicITC-Book_2sw;
	src: url("fonts/FranklinGothicITC-Book_2sw.woff") format("woff");
}

@font-face {
	font-family: Iosevka-Custom_901;
	src: url("fonts/Iosevka-Custom_901.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg253Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg253" style="-webkit-user-select: none;"><object width="714" height="1017" data="253/253.svg" type="image/svg+xml" id="pdf253" style="width:714px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_253" class="t s0_253">Глава 5. Гарантии корректности данных </span>
<span id="t2_253" class="t v0_253 s1_253">Версионирование в СУБД в памяти </span>
<span id="t3_253" class="t s2_253">В отличие от дискового пространства, разделённого на файлы, деление опера- </span>
<span id="t4_253" class="t s2_253">тивной памяти на «области» достаточно условно: оно требуется только для того, </span>
<span id="t5_253" class="t s2_253">чтобы оптимизировать распределение памяти. </span>
<span id="t6_253" class="t s2_253">Так, например, в SAP HANA память разделена на табличное пространство </span>
<span id="t7_253" class="t s2_253">(table space) и пространство версий (version space). Команда </span><span id="t8_253" class="t s3_253">INSERT</span><span id="t9_253" class="t s2_253">, создавая </span>
<span id="ta_253" class="t s2_253">новые строки, сохраняет их непосредственно в табличное пространство, а вот </span>
<span id="tb_253" class="t s2_253">команда </span><span id="tc_253" class="t s3_253">UPDATE</span><span id="td_253" class="t s2_253">, обновляя данные, сохраняет новые версии строк в пространство </span>
<span id="te_253" class="t s2_253">версий. В памяти системы поддерживается хеш-таблица, где для каждого ключа </span>
<span id="tf_253" class="t s2_253">хранится указатель на текущую версию строки. Текущая версия, в свою очередь, </span>
<span id="tg_253" class="t s2_253">является началом односвязного списка, в котором содержатся все версии строки. </span>
<span id="th_253" class="t s4_253">Табличное пространство </span><span id="ti_253" class="t s4_253">Пространство версий </span>
<span id="tj_253" class="t s4_253">13 </span>
<span id="tk_253" class="t s4_253">42 </span>
<span id="tl_253" class="t s4_253">88 </span>
<span id="tm_253" class="t s2_253">Сборщик мусора (garbage collector) удаляет из памяти неактуальные версии </span>
<span id="tn_253" class="t s2_253">строк, перенося новые версии из пространства версий в табличное пространство. </span>
<span id="to_253" class="t s2_253">В простейшем случае сборка мусора основана на временных метках: версия уда- </span>
<span id="tp_253" class="t s2_253">ляется, когда её временная метка становится меньше, чем временная метка са- </span>
<span id="tq_253" class="t s2_253">мой старой из исполняемых в системе транзакций. Однако такой подход ведёт </span>
<span id="tr_253" class="t s2_253">к росту потребления памяти, поскольку удаляет не все ненужные версии. </span>
<span id="ts_253" class="t s2_253">Пусть, например, в системе выполняются транзакции с временными метками </span>
<span id="tt_253" class="t s2_253">3, 100 и 105, а у записи есть версии с метками 1, 2, 5, 6, 7, 13, 45, 99, 103. Осно- </span>
<span id="tu_253" class="t s2_253">вываясь на временной метке самой старой транзакции, сборщик мусора может </span>
<span id="tv_253" class="t s2_253">удалить только версию с меткой 1, хотя версии с метками 5, 6, 7, 13, 45 также ни- </span>
<span id="tw_253" class="t s2_253">кому не нужны, поскольку транзакции с метками 100 и 105 должны видеть версии </span>
<span id="tx_253" class="t s2_253">с метками 99 и 103 соответственно. </span>
<span id="ty_253" class="t s2_253">В последних версиях SAP HANA применяются более сложные алгоритмы сбор- </span>
<span id="tz_253" class="t s2_253">ки мусора, подробное рассмотрение которых выходит за рамки книги. </span>
<span id="t10_253" class="t s2_253">Устройство механизма версионности в Tarantool сложнее, но элегантнее. Как </span>
<span id="t11_253" class="t s2_253">мы помним, при традиционной работе с этой СУБД версионность вообще не нуж- </span>
<span id="t12_253" class="t s2_253">на, т. к. транзакции выполняются действительно последовательно. Если же </span>
<span id="t13_253" class="t s2_253">252 </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
