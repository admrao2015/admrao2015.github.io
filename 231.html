<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p231" style="overflow: hidden; position: relative; background-color: white; width: 714px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_231{left:65px;bottom:947px;letter-spacing:0.02px;word-spacing:0.94px;}
#t2_231{left:83px;bottom:898px;letter-spacing:0.14px;word-spacing:1.96px;}
#t3_231{left:566px;bottom:898px;letter-spacing:0.15px;}
#t4_231{left:65px;bottom:876px;letter-spacing:0.13px;word-spacing:0.27px;}
#t5_231{left:242px;bottom:876px;letter-spacing:0.13px;word-spacing:0.26px;}
#t6_231{left:65px;bottom:854px;letter-spacing:0.12px;word-spacing:1.19px;}
#t7_231{left:65px;bottom:832px;letter-spacing:0.11px;}
#t8_231{left:83px;bottom:810px;letter-spacing:0.14px;word-spacing:1.52px;}
#t9_231{left:65px;bottom:788px;letter-spacing:0.13px;word-spacing:1.22px;}
#ta_231{left:65px;bottom:766px;letter-spacing:0.13px;word-spacing:0.05px;}
#tb_231{left:65px;bottom:745px;letter-spacing:0.13px;word-spacing:0.19px;}
#tc_231{left:65px;bottom:723px;letter-spacing:0.14px;word-spacing:-0.31px;}
#td_231{left:162px;bottom:614px;}
#te_231{left:207px;bottom:614px;}
#tf_231{left:162px;bottom:591px;}
#tg_231{left:207px;bottom:591px;}
#th_231{left:162px;bottom:568px;}
#ti_231{left:207px;bottom:568px;}
#tj_231{left:162px;bottom:545px;}
#tk_231{left:207px;bottom:545px;}
#tl_231{left:477px;bottom:614px;}
#tm_231{left:522px;bottom:614px;}
#tn_231{left:477px;bottom:591px;}
#to_231{left:522px;bottom:591px;}
#tp_231{left:477px;bottom:568px;}
#tq_231{left:522px;bottom:568px;}
#tr_231{left:477px;bottom:545px;}
#ts_231{left:522px;bottom:545px;}
#tt_231{left:477px;bottom:523px;}
#tu_231{left:522px;bottom:523px;}
#tv_231{left:310px;bottom:649px;}
#tw_231{left:310px;bottom:626px;}
#tx_231{left:310px;bottom:603px;}
#ty_231{left:310px;bottom:580px;}
#tz_231{left:310px;bottom:557px;}
#t10_231{left:310px;bottom:534px;}
#t11_231{left:310px;bottom:511px;}
#t12_231{left:327px;bottom:486px;letter-spacing:-0.22px;}
#t13_231{left:145px;bottom:486px;letter-spacing:-0.22px;word-spacing:0.02px;}
#t14_231{left:469px;bottom:486px;letter-spacing:-0.22px;word-spacing:0.03px;}
#t15_231{left:162.4px;bottom:641px;letter-spacing:-0.21px;}
#t16_231{left:178.4px;bottom:641px;letter-spacing:-0.21px;}
#t17_231{left:213.4px;bottom:640.5px;letter-spacing:-0.22px;}
#t18_231{left:229.4px;bottom:640.5px;letter-spacing:-0.21px;}
#t19_231{left:482.7px;bottom:640.5px;letter-spacing:-0.21px;}
#t1a_231{left:498.7px;bottom:640.5px;letter-spacing:-0.21px;}
#t1b_231{left:528.5px;bottom:640.5px;letter-spacing:-0.22px;}
#t1c_231{left:544.5px;bottom:640.5px;letter-spacing:-0.21px;}
#t1d_231{left:83px;bottom:459px;letter-spacing:0.13px;word-spacing:5.21px;}
#t1e_231{left:65px;bottom:437px;letter-spacing:0.15px;word-spacing:1.22px;}
#t1f_231{left:65px;bottom:415px;letter-spacing:0.13px;word-spacing:-0.3px;}
#t1g_231{left:83px;bottom:393px;letter-spacing:0.11px;word-spacing:1.37px;}
#t1h_231{left:65px;bottom:371px;letter-spacing:0.14px;word-spacing:0.33px;}
#t1i_231{left:65px;bottom:349px;letter-spacing:0.1px;word-spacing:-1.31px;}
#t1j_231{left:65px;bottom:327px;letter-spacing:0.07px;word-spacing:-0.18px;}
#t1k_231{left:83px;bottom:305px;letter-spacing:0.12px;word-spacing:0.38px;}
#t1l_231{left:65px;bottom:283px;letter-spacing:0.14px;word-spacing:-0.32px;}
#t1m_231{left:85px;bottom:261px;letter-spacing:0.15px;word-spacing:-0.31px;}
#t1n_231{left:101px;bottom:239px;letter-spacing:0.12px;word-spacing:-0.27px;}
#t1o_231{left:85px;bottom:218px;letter-spacing:0.12px;word-spacing:0.21px;}
#t1p_231{left:101px;bottom:196px;letter-spacing:0.12px;word-spacing:-0.28px;}
#t1q_231{left:85px;bottom:174px;letter-spacing:0.13px;word-spacing:0.11px;}
#t1r_231{left:101px;bottom:152px;letter-spacing:0.12px;word-spacing:-1.35px;}
#t1s_231{left:101px;bottom:130px;letter-spacing:0.15px;word-spacing:-0.33px;}
#t1t_231{left:65px;bottom:63px;letter-spacing:0.12px;}

.s0_231{font-size:15px;font-family:CharterITC-Italic_90p;color:#000;}
.s1_231{font-size:15px;font-family:CharterITC-Regular_90v;color:#000;}
.s2_231{font-size:15px;font-family:CharterITC-Bold_90j;color:#000;}
.s3_231{font-size:13px;font-family:FranklinGothicITC-Book_2kw;color:#000;}
.t.m0_231{transform:matrix(0,-1,1,0,0,0);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts231" type="text/css" >

@font-face {
	font-family: CharterITC-Bold_90j;
	src: url("fonts/CharterITC-Bold_90j.woff") format("woff");
}

@font-face {
	font-family: CharterITC-Italic_90p;
	src: url("fonts/CharterITC-Italic_90p.woff") format("woff");
}

@font-face {
	font-family: CharterITC-Regular_90v;
	src: url("fonts/CharterITC-Regular_90v.woff") format("woff");
}

@font-face {
	font-family: FranklinGothicITC-Book_2kw;
	src: url("fonts/FranklinGothicITC-Book_2kw.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg231Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg231" style="-webkit-user-select: none;"><object width="714" height="1017" data="231/231.svg" type="image/svg+xml" id="pdf231" style="width:714px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_231" class="t s0_231">Глава 5. Гарантии корректности данных </span>
<span id="t2_231" class="t s1_231">Ещё один способ обойтись без журналирования — использование </span><span id="t3_231" class="t s2_231">теневых </span>
<span id="t4_231" class="t s2_231">страниц (shadow pages)</span><span id="t5_231" class="t s1_231">, которые можно применять при страничной организа- </span>
<span id="t6_231" class="t s1_231">ции памяти. Иногда этот механизм называют копированием при записи (copy- </span>
<span id="t7_231" class="t s1_231">on-write). </span>
<span id="t8_231" class="t s1_231">Пусть у нас есть виртуальные страницы с данными и карта, которая ставит </span>
<span id="t9_231" class="t s1_231">в соответствие физические страницы логическим страницам. При необходимо- </span>
<span id="ta_231" class="t s1_231">сти изменить данные система копирует изменяемые физические страницы в но- </span>
<span id="tb_231" class="t s1_231">вое место и поддерживает в памяти копию карты, где логические страницы свя- </span>
<span id="tc_231" class="t s1_231">заны с новыми физическими страницами вместо существующих. </span>
<span id="td_231" class="t s3_231">1 </span><span id="te_231" class="t s3_231">1 </span>
<span id="tf_231" class="t s3_231">2 </span><span id="tg_231" class="t s3_231">5 </span>
<span id="th_231" class="t s3_231">3 </span><span id="ti_231" class="t s3_231">2 </span>
<span id="tj_231" class="t s3_231">4 </span><span id="tk_231" class="t s3_231">6 </span>
<span id="tl_231" class="t s3_231">1 </span><span id="tm_231" class="t s3_231">1 </span>
<span id="tn_231" class="t s3_231">2 </span><span id="to_231" class="t s3_231">7 </span>
<span id="tp_231" class="t s3_231">3 </span><span id="tq_231" class="t s3_231">2 </span>
<span id="tr_231" class="t s3_231">4 </span><span id="ts_231" class="t s3_231">6 </span>
<span id="tt_231" class="t s3_231">5 </span><span id="tu_231" class="t s3_231">4 </span>
<span id="tv_231" class="t s3_231">1 </span>
<span id="tw_231" class="t s3_231">2 </span>
<span id="tx_231" class="t s3_231">3 </span>
<span id="ty_231" class="t s3_231">4 </span>
<span id="tz_231" class="t s3_231">5 </span>
<span id="t10_231" class="t s3_231">6 </span>
<span id="t11_231" class="t s3_231">7 </span>
<span id="t12_231" class="t s3_231">данные </span><span id="t13_231" class="t s3_231">активная карта </span><span id="t14_231" class="t s3_231">новая карта </span>
<span id="t15_231" class="t m0_231 s3_231">Логическая </span>
<span id="t16_231" class="t m0_231 s3_231">страница </span>
<span id="t17_231" class="t m0_231 s3_231">Физическая </span>
<span id="t18_231" class="t m0_231 s3_231">страница </span>
<span id="t19_231" class="t m0_231 s3_231">Логическая </span>
<span id="t1a_231" class="t m0_231 s3_231">страница </span>
<span id="t1b_231" class="t m0_231 s3_231">Физическая </span>
<span id="t1c_231" class="t m0_231 s3_231">страница </span>
<span id="t1d_231" class="t s1_231">Все изменения транзакция делает в новых («теневых») страницах, кото- </span>
<span id="t1e_231" class="t s1_231">рые не видны другим транзакциям, а затем записывает изменённые страницы </span>
<span id="t1f_231" class="t s1_231">на диск. Завершением транзакции считается замена текущей карты на новую. </span>
<span id="t1g_231" class="t s1_231">Подход с теневыми страницами чрезвычайно надёжен: при сбое сервера по- </span>
<span id="t1h_231" class="t s1_231">вреждение сохранённых данных невозможно, а при восстановлении откат неза- </span>
<span id="t1i_231" class="t s1_231">вершённых транзакций происходит мгновенно. Этот подход используется в таких </span>
<span id="t1j_231" class="t s1_231">системах, как CouchDB и TokyoCabinet. </span>
<span id="t1k_231" class="t s1_231">Широкого распространения подход с теневыми страницами не получил из-за </span>
<span id="t1l_231" class="t s1_231">ряда существенных недостатков: </span>
<span id="t1m_231" class="t s1_231">• каждая транзакция целиком перезаписывает изменённые страницы, что ве- </span>
<span id="t1n_231" class="t s1_231">дёт к большому объёму ввода-вывода; </span>
<span id="t1o_231" class="t s1_231">• очень сложно организовать конкурентное обновление данных, чтобы одно- </span>
<span id="t1p_231" class="t s1_231">временно выполняющиеся транзакции меняли данные согласованно; </span>
<span id="t1q_231" class="t s1_231">• операция записи карты страниц на диск должна быть атомарной. В против- </span>
<span id="t1r_231" class="t s1_231">ном случае при сбое сервера в процессе перезаписи карты база данных будет </span>
<span id="t1s_231" class="t s1_231">повреждена безвозвратно. </span>
<span id="t1t_231" class="t s1_231">230 </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
